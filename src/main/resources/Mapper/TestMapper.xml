<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.edu.cqu.Dao.TestMapper">

	<insert id="insert_question">
		insert into
		question(question_problem,question_option_a,question_option_b,question_option_c,question_option_d,question_answer)
		values
		(#{question_problem},#{question_option_a},#{question_option_b},#{question_option_c},#{question_option_d},#{question_answer})
	</insert>

	<select id="select_all_question"
		resultType="cn.edu.cqu.Model.Question">
		select *
		from question
	</select>

	<update id="update_question">
		update question
		set question_problem =
		#{question_problem},question_option_a =
		#{question_option_a},question_option_b =
		#{question_option_b},question_option_c =
		#{question_option_c},question_option_d =
		#{question_option_d},question_answer = #{question_answer}
		where
		question_id = #{question_id}
	</update>

	<delete id="delete_question">
		delete from question
		where question_id =
		#{question_id}
	</delete>

	<select id="select_curr_test_id" resultType="int">
		select max(test_id)
		from test
	</select>

	<insert id="insert_test">
		insert into
		test(test_id,test_name,test_date_start,test_date_end) values
		(#{test_id},#{test_name},#{test_date_start},#{test_date_end})
	</insert>

	<insert id="insert_examination">
		insert into
		examination(test_id,question_id) values
		(#{test_id},#{question_id})
	</insert>

	<select id="select_test_id_now" resultType="String">
		select test_id
		from
		test
		where now() > test_date_start and test_date_end > now()
	</select>

	<select id="select_exam" resultType="cn.edu.cqu.Model.vQuestion">
		select
		*
		from examination_view
		where test_id = #{test_id}
	</select>

	<insert id="answer_question">
		insert into answer
		(test_id,question_id,student_id,answer_option,answer_date) values
		(#{test_id},#{question_id},#{student_id},#{answer_option},now())
	</insert>

	<select id="answer_result" resultType="int">
		select count(*)
		from answer
		where student_id =
		#{student_id} and test_id=#{test_id}
	</select>

	<select id="select_vTest" resultType="cn.edu.cqu.Model.vTest">
		select *
		from test_view
		where student_num = #{student_num}
	</select>

	<select id="select_vTest_correct_num" resultType="Integer">
		select count(*)
		from answer_view
		where student_num = #{student_num}
		and
		test_id =
		#{test_id}
		and question_answer
		= answer_option
	</select>

</mapper>